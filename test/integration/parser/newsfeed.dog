#!/usr/bin/env dog

IMPORT COMMUNITY "newsfeed" AS newsfeed

LISTEN TO PUBLIC VIA http AT "/" FOR home_page_requests
LISTEN TO PEOPLE FROM newsfeed VIA http AT "/dashboard" FOR dashboard_page_requests
LISTEN TO PEOPLE FROM newsfeed VIA http FOR post

ON home_page_request DO
  NOTIFY PERSON FROM home_page_request VIA http_response OF "index.erb"
END

ON dashboard_page_request DO
  NOTIFY PERSON FROM dashboard_page_request VIA http_response OF "index.erb"
END

ON EACH post DO
  poster = PERSON FROM post
  friends = PEOPLE FROM poster.newsfeed.friends
  NOTIFY friends VIA feed OF post
END